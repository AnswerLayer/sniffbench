{
  "version": "1.0",
  "repoPath": "/Users/primaryuser/answerlayer/sniffbench",
  "createdAt": "2025-12-05T22:14:10.828Z",
  "baselines": {
    "comp-001": {
      "caseId": "comp-001",
      "question": "Imagine you're writing the README for this project. Help me understand:\n\n- What does this project do? What problem does it solve?\n- Who is it for?\n- What are the main components or modules?\n- How is the codebase organized?\n\nGive me the \"elevator pitch\" version, then a slightly deeper dive\ninto the structure.\n",
      "answer": "Based on my exploration, here's a comprehensive overview of the **sniffbench** project:\n\n---\n\n## ğŸ¯ Elevator Pitch\n\n**Sniffbench is \"pytest for AI coding agents.\"** It's a benchmark suite that helps developers objectively measure how well AI assistants (Claude Code, Cursor, Aider, etc.) perform on real coding tasks.\n\n**The problem it solves:** When you change your AI coding setupâ€”switch models, tweak prompts, try new toolsâ€”you're flying blind. Did it actually get better? Sniffbench provides data-driven evaluation so you can measure improvement objectively instead of relying on gut feeling.\n\n**Target audience:** Developers using AI coding assistants who want to establish baselines and compare performance across configurations, as well as tool developers building or improving AI agents.\n\n---\n\n## ğŸ“ Codebase Structure\n\n```\nsniffbench/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ cli/              # Command-line interface (Commander.js)\nâ”‚   â”‚   â”œâ”€â”€ index.ts      # CLI entry point with 9 commands\nâ”‚   â”‚   â””â”€â”€ commands/     # Individual command implementations\nâ”‚   â”œâ”€â”€ agents/           # Agent wrapper infrastructure\nâ”‚   â”‚   â”œâ”€â”€ types.ts      # AgentWrapper interface\nâ”‚   â”‚   â”œâ”€â”€ claude-code.ts # Claude Code implementation  \nâ”‚   â”‚   â””â”€â”€ registry.ts   # Agent discovery/registration\nâ”‚   â”œâ”€â”€ cases/            # Test case management\nâ”‚   â”‚   â”œâ”€â”€ types.ts      # Case & rubric schemas\nâ”‚   â”‚   â””â”€â”€ loader.ts     # YAML/JSON loader with validation\nâ”‚   â”œâ”€â”€ sandbox/          # Docker sandboxing for safe execution\nâ”‚   â”‚   â””â”€â”€ types.ts      # Sandbox interfaces\nâ”‚   â”œâ”€â”€ rubrics/          # Grading criteria system\nâ”‚   â”‚   â””â”€â”€ defaults.ts   # Default evaluation weights\nâ”‚   â””â”€â”€ evaluation/       # Evaluation engine\nâ”‚       â””â”€â”€ runner.ts     # Core runner: runCases()\nâ”‚\nâ”œâ”€â”€ cases/                # Test case definitions\nâ”‚   â”œâ”€â”€ comprehension/    # 12 interview-style evaluation cases\nâ”‚   â””â”€â”€ bootstrap/        # 2 universal starter test cases\nâ”‚\nâ”œâ”€â”€ VALUES.md             # Philosophy: what good agents do\nâ”œâ”€â”€ ROADMAP.md            # 6-phase development plan\nâ””â”€â”€ package.json          # Node 18+, TypeScript, pnpm\n```\n\n---\n\n## ğŸ”§ Main Components\n\n### 1. **Agent Wrappers** (`src/agents/`)\nStandard interface for any coding agent. Currently implements Claude Code (`claude-code.ts:1-80`), which spawns the `claude` CLI and tracks success, duration, tools used, and tokens.\n\n```typescript\n// src/agents/types.ts:23-35\ninterface AgentWrapper {\n  name: string;\n  run(prompt: string, options?: AgentRunOptions): Promise<AgentResult>;\n  isAvailable(): Promise<boolean>;\n}\n```\n\n### 2. **Case System** (`src/cases/`)\nYAML-defined test cases with prompts, files, difficulty levels, and grading rubrics. Categories include comprehension, bootstrap, and generated cases.\n\n### 3. **Rubric System** (`src/rubrics/`)\nDefault evaluation criteria with weighted metrics (`defaults.ts:1-80`):\n- Correctness: 40%\n- Code Quality: 25%\n- Safety: 20%\n- Performance: 10%\n- Maintainability: 5%\n\n### 4. **Sandbox** (`src/sandbox/`)\nDocker-based isolation to run evaluations safely without corrupting real codebases.\n\n### 5. **CLI** (`src/cli/index.ts:1-119`)\nCommands: `init`, `run`, `add`, `compare`, `report`, `cases`, `status`, `doctor`, `interview`\n\n---\n\n## ğŸ’¡ Design Philosophy\n\nFrom `VALUES.md`, sniffbench measures what *actually matters* for coding agents:\n- **Style Adherence** â€“ Follows existing project patterns\n- **Targeted Changes** â€“ Minimal, focused changes (no over-engineering)\n- **Efficient Navigation** â€“ Researches codebase before acting\n- **Non-Regression** â€“ Existing tests still pass\n\nIt explicitly does **not** measure generic \"best practices\" divorced from project context.\n\n---\n\n## ğŸ“Š Current Status\n\n**Implemented:** CLI framework, case management, agent wrapper infrastructure, Claude Code integration, rubric system, 14 test cases\n\n**In Progress:** Docker sandboxing, interview command refinements\n\n**Planned:** LLM-powered case generation, multi-agent support (Cursor, Aider), reporting/comparison dashboards",
      "grade": 9,
      "gradedAt": "2025-12-05T22:16:04.914Z",
      "gradedBy": "human"
    },
    "comp-007": {
      "caseId": "comp-007",
      "question": "What are the 3-5 most important external dependencies in this project,\nand how are they used?\n\nFor each one:\n- What problem does it solve?\n- Where in the code is it used?\n- Are there any wrappers or abstractions around it?\n- Could it be replaced? How hard would that be?\n",
      "answer": "## Key External Dependencies in Sniffbench\n\nBased on my analysis, here are the **5 most important external dependencies**:\n\n---\n\n### 1. **Dockerode** (`dockerode@^4.0.2`) - CRITICAL\n\n**Problem:** Provides Node.js API for Docker daemon communication - creates isolated sandbox containers for agent evaluations.\n\n**Usage:**\n- **Primary:** `src/sandbox/docker.ts` (472 lines) - container lifecycle, execution, resource limits\n- **Consumers:** `src/cli/commands/run.ts`, `src/evaluation/runner.ts`, `src/cli/commands/doctor.ts`\n\n**Abstraction:** **Excellent** - Clean interface in `src/sandbox/types.ts` (`SandboxManager`, `Sandbox` interfaces). Factory in `src/sandbox/index.ts`. Rest of codebase uses interfaces only.\n\n**Replacement:** Medium difficulty - abstraction layer makes this feasible. Would implement new `SandboxManager` (e.g., Podman). ~2-4 days.\n\n---\n\n### 2. **Commander** (`commander@^12.0.0`) - CRITICAL\n\n**Problem:** CLI argument parsing, command routing, help text generation.\n\n**Usage:**\n- **Primary:** `src/cli/index.ts` (lines 3-118) - defines all commands (`init`, `run`, `add`, `cases`, `interview`, etc.)\n\n**Abstraction:** None - directly builds CLI tree.\n\n**Replacement:** High difficulty - entire CLI structure tied to Commander. ~3-5 days to port to yargs/minimist.\n\n---\n\n### 3. **YAML** (`yaml@^2.3.4`) - HIGH\n\n**Problem:** Parses YAML files for test case definitions and rubric configurations.\n\n**Usage:**\n- `src/cases/loader.ts:220` - parses case YAML files\n- `src/rubrics/loader.ts:57` - parses rubric definitions with inheritance\n\n**Abstraction:** None - direct `YAML.parse()` calls with error wrapping.\n\n**Replacement:** Medium - swap to js-yaml or similar. 2 files. ~1 day.\n\n---\n\n### 4. **Chalk** (`chalk@^5.3.0`) - HIGH\n\n**Problem:** Terminal coloring and styling for readable CLI output.\n\n**Usage:** 11 files across CLI commands - `src/utils/ui.ts` (box drawing), `src/cli/commands/run.ts` (status colors), all command files.\n\n**Abstraction:** Minimal - `src/utils/ui.ts` has a `box()` helper, but chalk used directly everywhere.\n\n**Replacement:** Medium - could use ANSI codes or alternatives. 11 files. ~1-2 days.\n\n---\n\n### 5. **Ora** (`ora@^8.0.0`) - MEDIUM\n\n**Problem:** Terminal spinners for progress indication.\n\n**Usage:** 5 CLI command files - `run.ts`, `status.ts`, `doctor.ts`, `cases.ts`, `interview.ts`\n\n**Abstraction:** None - direct instantiation.\n\n**Replacement:** Low difficulty - simple functionality. ~0.5-1 day.\n\n---\n\n### Summary\n\n| Dependency | Criticality | Abstraction | Replacement Cost |\n|------------|-------------|-------------|------------------|\n| Dockerode  | Critical    | Excellent   | Medium (~2-4d)   |\n| Commander  | Critical    | None        | High (~3-5d)     |\n| YAML       | High        | None        | Medium (~1d)     |\n| Chalk      | High        | Minimal     | Medium (~1-2d)   |\n| Ora        | Medium      | None        | Low (~0.5-1d)    |\n\n**Key insight:** Dockerode is the best-architected dependency with clean interface abstractions in `src/sandbox/`, while Commander is the most deeply embedded with no abstraction layer.",
      "grade": 9,
      "gradedAt": "2025-12-05T22:31:12.864Z",
      "gradedBy": "human"
    },
    "comp-006": {
      "caseId": "comp-006",
      "question": "How is this application configured for different environments?\n\n- Where do configuration values come from (env vars, files, etc.)?\n- How does the code access configuration?\n- What's different between development, staging, and production?\n- Are there any secrets? How are they managed?\n",
      "answer": "## Environment Configuration in Sniffbench\n\n### Configuration Sources\n\n1. **CLI Arguments** (highest priority)\n   - `--agent`, `--cases`, `--output`, `--timeout`, `--network` flags\n   - Defined in `src/cli/commands/*.ts`\n\n2. **Environment Variables**\n   - `CI='true'` - Set by `src/agents/claude-code.ts:89` for non-interactive mode\n   - `EDITOR` - Used by `src/cases/index.ts:118` for editing cases (defaults to 'vim')\n   - All env vars inherited by agent subprocesses (`src/agents/claude-code.ts:85-90`)\n\n3. **Project-Specific Directory** (`.sniffbench/`)\n   - `cases/` - Custom test cases\n   - `rubrics/` - Custom evaluation rubrics\n   - `baselines.json` - Interview baseline results\n\n4. **Installation Defaults**\n   - `cases/` and `rubrics/` directories in package root\n   - Hardcoded defaults in `src/sandbox/docker.ts:20-26` and `src/rubrics/defaults.ts`\n\n### How Code Accesses Configuration\n\n```typescript\n// Cases: src/cases/loader.ts:342-351\ngetDefaultCasesDir(projectRoot) // Checks .sniffbench/cases first, then falls back\n\n// Rubrics: src/rubrics/loader.ts:178-190  \nloadRubrics(projectRoot) // Loads from both project-specific and installation dirs\n\n// Sandbox: src/sandbox/docker.ts:189-197\nresolvedConfig = { ...config, image: config.image || DEFAULTS.image, ... }\n```\n\n### Environment Differentiation\n\n**Currently no dev/staging/production differentiation exists.** The architecture uses path-based resolution:\n1. Project-specific (`.sniffbench/`) - highest priority\n2. Installation defaults - fallback\n\nThis pattern could support future environment configs but isn't implemented.\n\n### Secrets Management\n\n**No explicit secret management implemented.** Security is handled via Docker isolation:\n- Network disabled by default (`src/sandbox/docker.ts:235`)\n- Read-only root filesystem (line 238)\n- Capability drops (lines 244-245)\n- No privileged mode (line 248)\n\nThe `SandboxConfig` interface supports `env?: Record<string, string>` for passing environment variables to sandboxed processes, which could be used for secrets in future.\n\n### Key Default Values\n\n| Setting | Default | Location |\n|---------|---------|----------|\n| Docker image | `node:20-slim` | `src/sandbox/docker.ts:20` |\n| Memory | 512MB | `src/sandbox/docker.ts:21` |\n| Timeout | 300s | `src/sandbox/docker.ts:23` |\n| Network | disabled | `src/sandbox/docker.ts:24` |\n| Pass threshold | 70% | `src/evaluation/runner.ts:366` |",
      "grade": 9,
      "gradedAt": "2025-12-05T22:33:15.420Z",
      "gradedBy": "human"
    }
  }
}